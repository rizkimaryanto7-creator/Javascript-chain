<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Explorer ‚Äî JS-Chain</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body { background:#121212; color:#fff }
    .mono { font-family: monospace; word-break: break-all }
  </style>
</head>
<body class="p-4">
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>üîç Block Explorer</h1>
    <div>
      <a class="btn btn-outline-info me-2" href="/wallets">Wallets</a>
      <a class="btn btn-outline-light" href="/miner">Miner</a>
    </div>
  </div>

  <form class="mb-4 d-flex" action="/search" method="GET">
    <input type="text" name="q" class="form-control me-2" placeholder="Search block, address, or TX hash" required>
    <button class="btn btn-primary">Search</button>
  </form>

  <canvas id="growthChart" height="80" class="mb-4"></canvas>

  <table class="table table-dark table-striped">
    <thead>
      <tr>
        <th>Index</th>
        <th>Hash</th>
        <th>Tx Count</th>
        <th>Time</th>
        <th>Miner</th>
      </tr>
    </thead>
    <tbody>
      <% jsChain.chain.slice().reverse().forEach(block => { 
        const rewardTx = block.transactions.find(tx => tx.from === 'SYSTEM');
      %>
        <tr>
          <td><a href="/block/<%= block.index %>" class="text-info"><%= block.index %></a></td>
          <td class="mono"><%= block.hash.slice(0, 16) %>...</td>
          <td><%= block.transactions.length %></td>
          <td><%= new Date(block.timestamp).toLocaleString() %></td>
          <td class="mono"><a href="/address/<%= rewardTx?.to %>" class="text-warning"><%= rewardTx?.to?.slice(0, 12) %>...</a></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<script>
const labels = [];
const txCounts = [];
<% jsChain.chain.forEach(block => { %>
  labels.push(<%= block.index %>);
  txCounts.push(<%= block.transactions.length %>);
<% }) %>

new Chart(document.getElementById('growthChart'), {
  type: 'bar',
  data: {
    labels,
    datasets: [{
      label: 'TX per Block',
      data: txCounts,
      backgroundColor: '#0d6efd'
    }]
  },
  options: {
    scales: {
      x: { ticks: { color: '#ccc' } },
      y: { ticks: { color: '#ccc' } }
    }
  }
});
</script>
</body>
</html>
